{% extends 'base.html.twig' %}

{% block title %}Mon profil{% endblock %}

{% block body %}
<div style="margin: -20px -20px 0 -20px; min-height: 100vh; background: #1a1d29; padding: 40px 20px;">
  <div style="max-width: 1200px; margin: 0 auto;">
    <div style="margin-bottom: 30px;">
      <h1 style="font-size: 28px; font-weight: 600; margin-bottom: 8px; color: #fff;">Mon profil</h1>
      <p style="color: #94a3b8;">Gérez vos informations personnelles et consultez vos réservations</p>
    </div>

    {% if success is defined and success %}
      <div style="background: #d1fae5; border: 1px solid #6ee7b7; color: #065f46; padding: 12px 16px; border-radius: 6px; margin-bottom: 20px;">
        ✓ Profil mis à jour avec succès
      </div>
    {% endif %}


    {% for message in app.flashes('success') %}
      <div id="success-flash" style="background: #d1fae5; border: 1px solid #6ee7b7; color: #065f46; padding: 12px 16px; border-radius: 6px; margin-bottom: 20px;">
        ✓ {{ message }}
      </div>
    {% endfor %}

    {% if app.request.get('_updated') %}
      <script>
        setTimeout(function() {
          alert('Profil mis à jour avec succès !');
          // Vider les champs mot de passe
          var fields = ['current_password', 'new_password', 'confirm_password'];
          fields.forEach(function(id) {
            var el = document.getElementById(id);
            if (el) el.value = '';
          });
        }, 200);
      </script>
    {% endif %}

    {% for message in app.flashes('error') %}
      <div style="background: #fee2e2; border: 1px solid #fca5a5; color: #991b1b; padding: 12px 16px; border-radius: 6px; margin-bottom: 20px;">
        ✗ {{ message }}
      </div>
    {% endfor %}

    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; align-items: start;">
      <!-- Formulaire -->
      <div style="background: #252837; border: 1px solid #334155; border-radius: 8px; padding: 24px; height: fit-content;">
        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 12px; color: #fff;">
          Informations personnelles
        </h2>
        <form method="post">
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 14px; font-weight: 500; color: #cbd5e1; margin-bottom: 6px;">
              Adresse e-mail
            </label>
            <input type="email" name="email" value="{{ user.email }}" required
                   style="width: 100%; padding: 8px 12px; border: 1px solid #475569; background: #1e293b; color: #fff; border-radius: 6px; font-size: 14px;">
          </div>
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 14px; font-weight: 500; color: #cbd5e1; margin-bottom: 6px;">
              Mot de passe actuel
            </label>
            <div style="position: relative;">
              <input type="password" name="current_password" id="current_password" placeholder="Votre mot de passe actuel" autocomplete="current-password"
                     style="width: 100%; padding: 8px 36px 8px 12px; border: 1px solid #475569; background: #1e293b; color: #fff; border-radius: 6px; font-size: 14px;">
              <span onclick="togglePassword('current_password')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #94a3b8;">
                <svg id="eye_current_password" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
              </span>
            </div>
          </div>
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 14px; font-weight: 500; color: #cbd5e1; margin-bottom: 6px;">
              Nouveau mot de passe
            </label>
            <div style="position: relative;">
              <input type="password" name="new_password" id="new_password" placeholder="Nouveau mot de passe" autocomplete="new-password"
                     style="width: 100%; padding: 8px 36px 8px 12px; border: 1px solid #475569; background: #1e293b; color: #fff; border-radius: 6px; font-size: 14px;">
              <span onclick="togglePassword('new_password')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #94a3b8;">
                <svg id="eye_new_password" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
              </span>
            </div>
          </div>
          <div style="margin-bottom: 20px;">
            <label style="display: block; font-size: 14px; font-weight: 500; color: #cbd5e1; margin-bottom: 6px;">
              Retapez le nouveau mot de passe
            </label>
            <div style="position: relative;">
              <input type="password" name="confirm_password" id="confirm_password" placeholder="Confirmez le nouveau mot de passe" autocomplete="new-password"
                     style="width: 100%; padding: 8px 36px 8px 12px; border: 1px solid #475569; background: #1e293b; color: #fff; border-radius: 6px; font-size: 14px;">
              <span onclick="togglePassword('confirm_password')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #94a3b8;">
                <svg id="eye_confirm_password" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
              </span>
            </div>
          </div>
          <button type="submit" style="width: 100%; background: #3b82f6; color: #fff; padding: 10px 16px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; font-size: 14px;">
            Mettre à jour
          </button>
        </form>
        <script>
        function togglePassword(id) {
          const input = document.getElementById(id);
          const eye = document.getElementById('eye_' + id);
          if (input.type === 'password') {
            input.type = 'text';
            eye.style.opacity = 0.5;
          } else {
            input.type = 'password';
            eye.style.opacity = 1;
          }
        }
        </script>
        </form>
      </div>

      <!-- Réservations -->
      <div style="background: #252837; border: 1px solid #334155; border-radius: 8px; padding: 24px;">
        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 12px; color: #fff;">
          Mes réservations
        </h2>
      {% if user.getReservations()|length > 0 %}
        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
          <thead>
            <tr style="background: #1e293b; border-bottom: 2px solid #334155;">
              <th style="text-align: left; padding: 12px 8px; font-weight: 600; color: #cbd5e1;">Film</th>
              <th style="text-align: left; padding: 12px 8px; font-weight: 600; color: #cbd5e1;">Date</th>
              <th style="text-align: center; padding: 12px 8px; font-weight: 600; color: #cbd5e1;">Places</th>
              <th style="text-align: center; padding: 12px 8px; font-weight: 600; color: #cbd5e1;">Salle</th>
              <th style="text-align: center; padding: 12px 8px; font-weight: 600; color: #cbd5e1;">Statut</th>
              <th style="text-align: center; padding: 12px 8px; font-weight: 600; color: #cbd5e1;">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for reservation in user.getReservations() %}
              <tr style="border-bottom: 1px solid #334155;">
                <td style="padding: 12px 8px; color: #e2e8f0;">{{ reservation.getSeance().getFilm().getTitre() }}</td>
                <td style="padding: 12px 8px; color: #94a3b8;">{{ reservation.getSeance().getDatetime()|date('d/m/Y H:i') }}</td>
                <td style="padding: 12px 8px; text-align: center;">
                  <span style="background: #1e40af; color: #dbeafe; padding: 4px 12px; border-radius: 9999px; font-size: 13px; font-weight: 500;">
                    {{ reservation.getNombrePlaces() }}
                  </span>
                </td>
                <td style="padding: 12px 8px; text-align: center;">
                  <span style="background: #374151; color: #d1d5db; padding: 4px 12px; border-radius: 9999px; font-size: 13px; font-weight: 500;">
                    {{ reservation.getSeance().getSalle().getNumero() }}
                  </span>
                </td>
                <td style="padding: 12px 8px; text-align: center;">
                  {% if reservation.getStatut() and reservation.getStatut().value == 'Confirmé' %}
                    <span style="background: #065f46; color: #d1fae5; padding: 4px 12px; border-radius: 9999px; font-size: 13px; font-weight: 500;">
                      ✓ Confirmée
                    </span>
                  {% else %}
                    <span style="background: #991b1b; color: #fee2e2; padding: 4px 12px; border-radius: 9999px; font-size: 13px; font-weight: 500;">
                      ✗ Annulée
                    </span>
                  {% endif %}
                </td>
                <td style="padding: 12px 8px; text-align: center;">
                  {% if reservation.getStatut() and reservation.getStatut().value == 'Confirmé' %}
                    <form method="post" action="{{ path('app_profil_annuler_reservation', {id: reservation.getId()}) }}" style="display: inline;" onsubmit="return confirm('Êtes-vous sûr de vouloir annuler cette réservation ?');">
                      <button type="submit" style="background: #dc2626; color: #fff; padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;">
                        Annuler
                      </button>
                    </form>
                  {% else %}
                    <span style="color: #64748b; font-size: 12px;">—</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
          <div style="text-align: center; padding: 40px 20px; color: #64748b;">
            <p>Aucune réservation pour le moment</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
